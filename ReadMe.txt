This is the latest K9YO_WSPR for a SAMD21 no vhf

Special WSPR telemetry protocol
S-4 (VE3KCL) (qrp-labs.com)
As background, this is a very useful document by Andy G4JNT, explaining the process for encoding callsign, Maidenhead square, and power into the WSPR tones sequence. This document was used as the basis of the Ultimate3 source code for the WSPR mode. In particular, note that although standard WSPR messages transmit three pieces of information - callsign, locator and power - in fact, the encoding splits into two blocks: callsign, and locator/power. 
Following is a brief explanation of the special WSPR telemetry protocol used on the S-4 balloon flight. 
The callsign field in the WSPR protocol is 6 characters. The first character can be 0-9, A-Z or space. The second character can be in the range 0-9, A-Z (but cannot be a space). The third character must be a number in the range 0-9. The final three characters can be any letter A-Z, or a space. 
Balloon messages identification:
The data from the S-4 balloon is sent with 1st and 3rd character being zero. For example. 0C0QQE. This permits the messages from the balloon to be identified in the WSPRnet database. The ITU does not allocate callsigns starting in "0" or "Q". So any callsign where the 1st character is "0" or "Q" and the third character is 0-9, could be used with the S-4 balloon telemetry. Therefore 20 "channels" exist so 20 balloons could operate simultaneously using this protocol. 
Subsquare and altitude encoding:
The 4-character Maidenhead locator sent by a standard WSPR message, has a position accuracy of 100km or more (depending on where on Earth you are). See ARRL's page: "...measures approximately 70 x 100 miles in the continental US". Better position accuracy can be obtained by adding two further characters, making 6-character Maidenhead locators overall: "...corresponding to 3 x 4 miles in the continental US". For balloon tracking using WSPR, the position takes several minutes to send, and in the case of S-4, is sent every 12 minutes. The GPS position snapshot is taken at the start of the 12 minute cycle. The balloon will typically have moved considerably by the time the position report has been sent, received and decoded. So the Maidenhead subsquare resolution was felt to be adequate for tracking a long distance balloon. 
The 5th and 6th Maidenhead characters (subsquare) are letters in the range "A" to "X". There are 24 possible values. For the two letters, there are 576 possible combinations. In the S-4 the altitude in meters, is divided by 20. A number in the range 0..1067 therefore represents altitude in the range 0..21,340m with a resolution of 20m. The encoding in the S-4 proceeds by converting the subsquare into a number in the range 0..575. E.g. "IQ" is (8 * 24) + 16, which is 208. The final number for encoding into the callsign is calculated as (1068 * subsquare) + (altitude / 20), where altitude in in meters. This number is in the range 0..613525 (i.e. 575 * 1067). For example, if the subsquare is "IQ" and altitude 1000m, then the the "callsign" number will be (208 * 1068) + (1000 / 20) = 222,194. 
This decimal representation of the subsquare and altitude is converted into 4 characters that are overlaid on top of characters 2, 4, 5 and 6 of the callsign. Spaces are not used in this case. The 2nd character is base 36 (0-9 and A-Z), the 4th, 5th and 6th characters are base 26 (A-Z). There are 36 * 26 * 26 * 26 permutations which is 632,736. So (by design), the maximum possible subsquare/altiutude number 613,525 fits comfortably inside the number of permutations of characters 632,736. 
Temperature, battery voltage, speed, GPS status, satellite status encoding:
Encoding of these additional parameters follows the above general procedure, over-writing the 4-character Maidenhead locator WSPR field and the power field, with values encoded from the required data. The first two Maidenhead locator characters are in the range A-R, having 18 possible values. The 3rd and 4th locator characters are in the range 0-9, i.e. 10 possible values. The power is base 19. This is because according to the WSPR protocol the power in dBm must be in the range 0..60dBm but can only occupy discrete power levels 0, 3, 7, 10, 13, 17 etc. up to 60dBm. There are 19 possible values. The number of permutations of 4-character Maidenhead locator and Power, in the WSPR fields, is therefore 18 * 18 * 10 * 10 * 19 which is 615,600. The required telemetry must therefore be compressed into a number not more than 615,600. 
The temperature is coded by a number in the range 0..89, which represents temperatures in the range -50C to +39C with a resolution of 1C. On the balloon they came from an analogue temperature sensor, read by the ATmega328's ADC peripheral.
Battery voltage is coded by a number in the range 0..39, which represents battery voltage in the range 3.00 to 4.95V with a resolution of 0.05V. On the balloon battery voltage is measured by the ATmega328's ADC peripheral.
Speed in knots, is taken from the GPS NMEA serial data directly (ground speed parameter) and is measured in knots. It is coded by a number in the range 0..41, which represents 0 to 82 knots with a resolution of 2 knots. 
Two GPS status bits follow; the first is 1 if the GPS data validity flag in $GPRMC is "A", 0 otherwise. The second bit is 1 if the number of tracked satellites is at least 8, which is a reasonable indication of good GPS reception health. 
The maximum number of permutations of these pieces of data is therefore 90 * 40 * 42 * 2 * 2 = 604,800 which fits inside the available 615,600 permutations (see above). Encoding proceeds by calculating a total number to represent these pieces of data: Satellites + 2 * (GPS status + 2 * (Speed + 42 * (Battery + 40 * Temperature))). Once obtained, this number is encoded back into the 4-character locator and 19-level power fields, which are 5 items with base 18, 18, 10, 10, 19 respectively. 
Downloads
THIS SPREADSHEET illustrates the encoding and decoding. It can be used to decode WSPRnet reports, such as the example 0C0QQE RG74 43 given above. 

